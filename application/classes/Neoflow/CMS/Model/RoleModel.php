<?phpnamespace Neoflow\CMS\Model;use Neoflow\Framework\Core\AbstractModel;class RoleModel extends AbstractModel{    /**     * @var string     */    public static $tableName = 'roles';    /**     * @var string     */    public static $primaryKey = 'role_id';    /**     * @var array     */    public static $properties = ['role_id', 'title', 'description'];    public function permissions()    {        return $this->hasManyThrough('\\Neoflow\\CMS\\Model\\PermissionModel', '\\Neoflow\\CMS\\Model\\RolePermissionModel', 'role_id', 'permission_id');    }    /**     * Validate setting entity     *     * @return bool     */    public function validate()    {        $validator = new \Neoflow\Framework\Handler\Validation\Validator($this->toArray());        $validator            ->required()            ->betweenLength(3, 50)            ->callback(function($title, $role) {                $roleRepository = new \Neoflow\CMS\Repository\RoleRepository();                $roles = $roleRepository                    ->where('title', '=', $title)                    ->where('role_id', '!=', $role->id())                    ->fetchAll();                return (count($roles) === 0);            }, '{0} has to be unique', array($this))            ->set('title', 'Title');        $validator            ->required()            ->set('visibility', 'Visibility');        return $validator->validate();    }    public function save($validate = true)    {        if (parent::save($validate)) {            RolePermissionModel::findAllByColumn('role_id', $this->id())->delete();            if ($this->permission_ids) {                foreach ($this->permission_ids as $permission_id) {                    RolePermissionModel::create(array(                        'role_id' => $this->id(),                        'permission_id' => $permission_id                    ));                }            }            return true;        }        return false;    }}